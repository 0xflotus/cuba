<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Cuba by soveran</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Cuba</h1>
        <p>Rum based microframework for web development.</p>

        <p class="view"><a href="https://github.com/soveran/cuba">View the Project on GitHub <small>soveran/cuba</small></a></p>


        <ul>
          <li><a href="https://github.com/soveran/cuba/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/soveran/cuba/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/soveran/cuba">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="viva-cuba" class="anchor" href="#viva-cuba"><span class="octicon octicon-link"></span></a>Viva Cuba!</h1>

<p>Cuba is a Ruby microframework for web development.</p>

<h2>
<a name="community" class="anchor" href="#community"><span class="octicon octicon-link"></span></a>Community</h2>

<p>Meet us on IRC: #cuba.rb on <a href="http://freenode.net/">freenode.net</a>.</p>

<h2>
<a name="description" class="anchor" href="#description"><span class="octicon octicon-link"></span></a>Description</h2>

<p>Cuba is a microframework for web development originally inspired
by <a href="http://github.com/chneukirchen/rum">Rum</a>, a tiny but powerful mapper for <a href="http://github.com/chneukirchen/rack">Rack</a>
applications.</p>

<p>It integrates many templates via <a href="http://github.com/rtomayko/tilt">Tilt</a>, and testing via
<a href="http://github.com/djanowski/cutest">Cutest</a> and <a href="http://github.com/jnicklas/capybara">Capybara</a>.</p>

<h2>
<a name="guide" class="anchor" href="#guide"><span class="octicon octicon-link"></span></a>Guide</h2>

<p>There's a book called <a href="http://theguidetocuba.io">The Guide to Cuba</a> that explains how
to build web applications by following a minimalistic approach. It
is recommended reading for anyone trying to learn the basics of
Cuba and other related tools.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<div class="highlight highlight-console"><pre><span class="gp">$</span> gem install cuba
</pre></div>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Here's a simple application:</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># cat hello_world.rb</span>
<span class="nb">require</span> <span class="s2">"cuba"</span>
<span class="nb">require</span> <span class="s2">"rack/protection"</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Session</span><span class="o">::</span><span class="no">Cookie</span><span class="p">,</span> <span class="ss">:secret</span> <span class="o">=&gt;</span> <span class="s2">"__a_very_long_string__"</span>
<span class="no">Cuba</span><span class="o">.</span><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Protection</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">on</span> <span class="n">get</span> <span class="k">do</span>
    <span class="n">on</span> <span class="s2">"hello"</span> <span class="k">do</span>
      <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"Hello world!"</span>
    <span class="k">end</span>

    <span class="n">on</span> <span class="n">root</span> <span class="k">do</span>
      <span class="n">res</span><span class="o">.</span><span class="n">redirect</span> <span class="s2">"/hello"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>And the test file:</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># cat hello_world_test.rb</span>
<span class="nb">require</span> <span class="s2">"cuba/test"</span>
<span class="nb">require</span> <span class="s2">"./hello_world"</span>

<span class="n">scope</span> <span class="k">do</span>
  <span class="nb">test</span> <span class="s2">"Homepage"</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s2">"/"</span>

    <span class="n">follow_redirect!</span>

    <span class="n">assert_equal</span> <span class="s2">"Hello world!"</span><span class="p">,</span> <span class="n">last_response</span><span class="o">.</span><span class="n">body</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>To run it, you can create a <code>config.ru</code> file:</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># cat config.ru</span>
<span class="nb">require</span> <span class="s2">"./hello_world"</span>

<span class="n">run</span> <span class="no">Cuba</span>
</pre></div>

<p>You can now run <code>rackup</code> and enjoy what you have just created.</p>

<h2>
<a name="matchers" class="anchor" href="#matchers"><span class="octicon octicon-link"></span></a>Matchers</h2>

<p>Here's an example showcasing how different matchers work:</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s2">"cuba"</span>
<span class="nb">require</span> <span class="s2">"rack/protection"</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Session</span><span class="o">::</span><span class="no">Cookie</span><span class="p">,</span> <span class="ss">:secret</span> <span class="o">=&gt;</span> <span class="s2">"__a_very_long_string__"</span>
<span class="no">Cuba</span><span class="o">.</span><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Protection</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>

  <span class="c1"># only GET requests</span>
  <span class="n">on</span> <span class="n">get</span> <span class="k">do</span>

    <span class="c1"># /</span>
    <span class="n">on</span> <span class="n">root</span> <span class="k">do</span>
      <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"Home"</span>
    <span class="k">end</span>

    <span class="c1"># /about</span>
    <span class="n">on</span> <span class="s2">"about"</span> <span class="k">do</span>
      <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"About"</span>
    <span class="k">end</span>

    <span class="c1"># /styles/basic.css</span>
    <span class="n">on</span> <span class="s2">"styles"</span><span class="p">,</span> <span class="n">extension</span><span class="p">(</span><span class="s2">"css"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
      <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"Filename: </span><span class="si">#{</span><span class="n">file</span><span class="si">}</span><span class="s2">"</span> <span class="c1">#=&gt; "Filename: basic"</span>
    <span class="k">end</span>

    <span class="c1"># /post/2011/02/16/hello</span>
    <span class="n">on</span> <span class="s2">"post/:y/:m/:d/:slug"</span> <span class="k">do</span> <span class="o">|</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">slug</span><span class="o">|</span>
      <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"</span><span class="si">#{</span><span class="n">y</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">m</span><span class="si">}</span><span class="s2">-</span><span class="si">#{</span><span class="n">d</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">slug</span><span class="si">}</span><span class="s2">"</span> <span class="c1">#=&gt; "2011-02-16 hello"</span>
    <span class="k">end</span>

    <span class="c1"># /username/foobar</span>
    <span class="n">on</span> <span class="s2">"username/:username"</span> <span class="k">do</span> <span class="o">|</span><span class="n">username</span><span class="o">|</span>
      <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_username</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="c1"># username == "foobar"</span>

      <span class="c1"># /username/foobar/posts</span>
      <span class="n">on</span> <span class="s2">"posts"</span> <span class="k">do</span>

        <span class="c1"># You can access `user` here, because the `on` blocks</span>
        <span class="c1"># are closures.</span>
        <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"Total Posts: </span><span class="si">#{</span><span class="n">user</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span> <span class="c1">#=&gt; "Total Posts: 6"</span>
      <span class="k">end</span>

      <span class="c1"># /username/foobar/following</span>
      <span class="n">on</span> <span class="s2">"following"</span> <span class="k">do</span>
        <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="n">user</span><span class="o">.</span><span class="n">following</span><span class="o">.</span><span class="n">size</span> <span class="c1">#=&gt; "1301"</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># /search?q=barbaz</span>
    <span class="n">on</span> <span class="s2">"search"</span><span class="p">,</span> <span class="n">param</span><span class="p">(</span><span class="s2">"q"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">query</span><span class="o">|</span>
      <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"Searched for </span><span class="si">#{</span><span class="n">query</span><span class="si">}</span><span class="s2">"</span> <span class="c1">#=&gt; "Searched for barbaz"</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># only POST requests</span>
  <span class="n">on</span> <span class="n">post</span> <span class="k">do</span>
    <span class="n">on</span> <span class="s2">"login"</span> <span class="k">do</span>

      <span class="c1"># POST /login, user: foo, pass: baz</span>
      <span class="n">on</span> <span class="n">param</span><span class="p">(</span><span class="s2">"user"</span><span class="p">),</span> <span class="n">param</span><span class="p">(</span><span class="s2">"pass"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="p">,</span> <span class="n">pass</span><span class="o">|</span>
        <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"</span><span class="si">#{</span><span class="n">user</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">pass</span><span class="si">}</span><span class="s2">"</span> <span class="c1">#=&gt; "foo:baz"</span>
      <span class="k">end</span>

      <span class="c1"># If the params `user` and `pass` are not provided, this</span>
      <span class="c1"># block will get executed.</span>
      <span class="n">on</span> <span class="kp">true</span> <span class="k">do</span>
        <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"You need to provide user and pass!"</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="status-codes" class="anchor" href="#status-codes"><span class="octicon octicon-link"></span></a>Status codes</h2>

<p>If you don't assign a status code and you don't write to the <code>res</code>
object, the status will be set as <code>404</code>.</p>

<p>For example:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Cuba</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">on</span> <span class="n">get</span> <span class="k">do</span>
    <span class="n">on</span> <span class="s2">"hello"</span> <span class="k">do</span>
      <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"hello world"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Requests:</span>
<span class="c1">#</span>
<span class="c1"># GET /            # 404</span>
<span class="c1"># GET /hello       # 200</span>
<span class="c1"># GET /hello/world # 200</span>
</pre></div>

<p>As you can see, as soon as something was written to the response,
the status code was changed to 200.</p>

<p>If you want to match just "hello", but not "hello/world", you can do
as follows:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Cuba</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">on</span> <span class="n">get</span> <span class="k">do</span>
    <span class="n">on</span> <span class="s2">"hello"</span> <span class="k">do</span>
      <span class="n">on</span> <span class="n">root</span> <span class="k">do</span>
        <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"hello world"</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Requests:</span>
<span class="c1">#</span>
<span class="c1"># GET /            # 404</span>
<span class="c1"># GET /hello       # 200</span>
<span class="c1"># GET /hello/world # 404</span>
</pre></div>

<p>You can also use a regular expression to match the end of line:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Cuba</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">on</span> <span class="n">get</span> <span class="k">do</span>
    <span class="n">on</span> <span class="sr">/hello\/?\z/</span> <span class="k">do</span>
      <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"hello world"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Requests:</span>
<span class="c1">#</span>
<span class="c1"># GET /            # 404</span>
<span class="c1"># GET /hello       # 200</span>
<span class="c1"># GET /hello/world # 404</span>
</pre></div>

<p>This last example is not a common usage pattern. It's here only to
illustrate how Cuba can be adapted for different use cases.</p>

<p>If you need this behavior, you can create a helper:</p>

<div class="highlight highlight-ruby"><pre><span class="k">module</span> <span class="nn">TerminalMatcher</span>
  <span class="k">def</span> <span class="nf">terminal</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="sr">/</span><span class="si">#{</span><span class="n">path</span><span class="si">}</span><span class="sr">\/?\z/</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">plugin</span> <span class="no">TerminalMatcher</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">on</span> <span class="n">get</span> <span class="k">do</span>
    <span class="n">on</span> <span class="n">terminal</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="s2">"hello world"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="security" class="anchor" href="#security"><span class="octicon octicon-link"></span></a>Security</h2>

<p>The favorite security layer for Cuba is
<a href="https://github.com/rkh/rack-protection">Rack::Protection</a>. It is not included by default
because there are legitimate uses for plain Cuba (for instance,
when designing an API).</p>

<p>If you are building a web application, by all means make sure
to include a security layer. As it is the convention for unsafe
operations, only POST, PUT and DELETE requests are monitored.</p>

<p>You should also always set a session secret to some undisclosed
value. Keep in mind that the content in the session cookie is
<em>not</em> encrypted.</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s2">"cuba"</span>
<span class="nb">require</span> <span class="s2">"rack/protection"</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Session</span><span class="o">::</span><span class="no">Cookie</span><span class="p">,</span> <span class="ss">:secret</span> <span class="o">=&gt;</span> <span class="s2">"__a_very_long_string__"</span>
<span class="no">Cuba</span><span class="o">.</span><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Protection</span>
<span class="no">Cuba</span><span class="o">.</span><span class="n">use</span> <span class="no">Rack</span><span class="o">::</span><span class="no">Protection</span><span class="o">::</span><span class="no">RemoteReferrer</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>

  <span class="c1"># Now your app is protected against a wide range of attacks.</span>
  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="http-verbs" class="anchor" href="#http-verbs"><span class="octicon octicon-link"></span></a>HTTP Verbs</h2>

<p>There are four matchers defined for HTTP Verbs: <code>get</code>, <code>post</code>, <code>put</code> and
<code>delete</code>. But the world doesn't end there, does it? As you have the whole
request available via the <code>req</code> object, you can query it with helper methods
like <code>req.options?</code> or <code>req.head?</code>, or you can even go to a lower level
and inspect the environment via the <code>env</code> object, and check for example if
<code>env["REQUEST_METHOD"]</code> equals the obscure verb <code>PATCH</code>.</p>

<p>What follows is an example of different ways of saying the same thing:</p>

<div class="highlight highlight-ruby"><pre><span class="n">on</span> <span class="n">env</span><span class="o">[</span><span class="s2">"REQUEST_METHOD"</span><span class="o">]</span> <span class="o">==</span> <span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"api"</span> <span class="k">do</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="k">end</span>

<span class="n">on</span> <span class="n">req</span><span class="o">.</span><span class="n">get?</span><span class="p">,</span> <span class="s2">"api"</span> <span class="k">do</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="k">end</span>

<span class="n">on</span> <span class="n">get</span><span class="p">,</span> <span class="s2">"api"</span> <span class="k">do</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span> <span class="k">end</span>
</pre></div>

<p>Actually, <code>get</code> is syntax sugar for <code>req.get?</code>, which in turn is syntax sugar
for <code>env["REQUEST_METHOD"] == "GET"</code>.</p>

<h2>
<a name="request-and-response" class="anchor" href="#request-and-response"><span class="octicon octicon-link"></span></a>Request and Response</h2>

<p>You may have noticed we use <code>req</code> and <code>res</code> a lot. Those variables are
instances of <a href="http://rack.rubyforge.org/doc/classes/Rack/Request.html">Rack::Request</a> and <code>Cuba::Response</code> respectively, and
<code>Cuba::Response</code> is just an optimized version of
<a href="http://rack.rubyforge.org/doc/classes/Rack/Response.html">Rack::Response</a>.</p>

<p>Those objects are helpers for accessing the request and for building
the response. Most of the time, you will just use <code>res.write</code>.</p>

<p>If you want to use custom <code>Request</code> or <code>Response</code> objects, you can
set the new values as follows:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Cuba</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:req</span><span class="o">]</span> <span class="o">=</span> <span class="no">MyRequest</span>
<span class="no">Cuba</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:res</span><span class="o">]</span> <span class="o">=</span> <span class="no">MyResponse</span>
</pre></div>

<p>Make sure to provide classes compatible with those from Rack.</p>

<h2>
<a name="captures" class="anchor" href="#captures"><span class="octicon octicon-link"></span></a>Captures</h2>

<p>You may have noticed that some matchers yield a value to the block. The rules
for determining if a matcher will yield a value are simple:</p>

<ol>
<li>Regex captures: <code>"posts/(\\d+)-(.*)"</code> will yield two values, corresponding to each capture.</li>
<li>Placeholders: <code>"users/:id"</code> will yield the value in the position of :id.</li>
<li>Symbols: <code>:foobar</code> will yield if a segment is available.</li>
<li>File extensions: <code>extension("css")</code> will yield the basename of the matched file.</li>
<li>Parameters: <code>param("user")</code> will yield the value of the parameter user, if present.</li>
</ol><p>The first case is important because it shows the underlying effect of regex
captures.</p>

<p>In the second case, the substring <code>:id</code> gets replaced by <code>([^\\/]+)</code> and the
string becomes <code>"users/([^\\/]+)"</code> before performing the match, thus it reverts
to the first form we saw.</p>

<p>In the third case, the symbol ––no matter what it says––gets replaced
by <code>"([^\\/]+)"</code>, and again we are in presence of case 1.</p>

<p>The fourth case, again, reverts to the basic matcher: it generates the string
<code>"([^\\/]+?)\.#{ext}\\z"</code> before performing the match.</p>

<p>The fifth case is different: it checks if the the parameter supplied is present
in the request (via POST or QUERY_STRING) and it pushes the value as a capture.</p>

<h2>
<a name="composition" class="anchor" href="#composition"><span class="octicon octicon-link"></span></a>Composition</h2>

<p>You can mount a Cuba app, along with middlewares, inside another Cuba app:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">API</span> <span class="o">&lt;</span> <span class="no">Cuba</span><span class="p">;</span> <span class="k">end</span>

<span class="no">API</span><span class="o">.</span><span class="n">use</span> <span class="no">SomeMiddleware</span>

<span class="no">API</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">on</span> <span class="n">param</span><span class="p">(</span><span class="s2">"url"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">url</span><span class="o">|</span>
    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">on</span> <span class="s2">"api"</span> <span class="k">do</span>
    <span class="n">run</span> <span class="no">API</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="testing" class="anchor" href="#testing"><span class="octicon octicon-link"></span></a>Testing</h2>

<p>Given that Cuba is essentially Rack, it is very easy to test with
<code>Rack::Test</code>, <code>Webrat</code> or <code>Capybara</code>. Cuba's own tests are written
with a combination of <a href="http://github.com/djanowski/cutest">Cutest</a> and <a href="https://github.com/brynary/rack-test">Rack::Test</a>,
and if you want to use the same for your tests it is as easy as
requiring <code>cuba/test</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s2">"cuba/test"</span>
<span class="nb">require</span> <span class="s2">"your/app"</span>

<span class="n">scope</span> <span class="k">do</span>
  <span class="nb">test</span> <span class="s2">"Homepage"</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s2">"/"</span>

    <span class="n">assert_equal</span> <span class="s2">"Hello world!"</span><span class="p">,</span> <span class="n">last_response</span><span class="o">.</span><span class="n">body</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>If you prefer to use <a href="http://github.com/jnicklas/capybara">Capybara</a>, instead of requiring
<code>cuba/test</code> you can require <code>cuba/capybara</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s2">"cuba/capybara"</span>
<span class="nb">require</span> <span class="s2">"your/app"</span>

<span class="n">scope</span> <span class="k">do</span>
  <span class="nb">test</span> <span class="s2">"Homepage"</span> <span class="k">do</span>
    <span class="n">visit</span> <span class="s2">"/"</span>

    <span class="n">assert</span> <span class="n">has_content?</span><span class="p">(</span><span class="s2">"Hello world!"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>To read more about testing, check the documentation for
<a href="http://github.com/djanowski/cutest">Cutest</a>, <a href="https://github.com/brynary/rack-test">Rack::Test</a> and <a href="http://github.com/jnicklas/capybara">Capybara</a>.</p>

<h2>
<a name="settings" class="anchor" href="#settings"><span class="octicon octicon-link"></span></a>Settings</h2>

<p>Each Cuba app can store settings in the <code>Cuba.settings</code> hash. The settings are
inherited if you happen to subclass <code>Cuba</code></p>

<div class="highlight highlight-ruby"><pre><span class="no">Cuba</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:layout</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"guest"</span>

<span class="k">class</span> <span class="nc">Users</span> <span class="o">&lt;</span> <span class="no">Cuba</span><span class="p">;</span> <span class="k">end</span>
<span class="k">class</span> <span class="nc">Admin</span> <span class="o">&lt;</span> <span class="no">Cuba</span><span class="p">;</span> <span class="k">end</span>

<span class="no">Admin</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:layout</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"admin"</span>

<span class="n">assert_equal</span> <span class="s2">"guest"</span><span class="p">,</span> <span class="no">Users</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:layout</span><span class="o">]</span>
<span class="n">assert_equal</span> <span class="s2">"admin"</span><span class="p">,</span> <span class="no">Admin</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:layout</span><span class="o">]</span>
</pre></div>

<p>Feel free to store whatever you find convenient.</p>

<h2>
<a name="rendering" class="anchor" href="#rendering"><span class="octicon octicon-link"></span></a>Rendering</h2>

<p>Cuba includes a plugin called <code>Cuba::Render</code> that provides a couple of helper
methods for rendering templates. This plugin uses <a href="http://github.com/rtomayko/tilt">Tilt</a>, which serves as
an interface to a bunch of different Ruby template engines (ERB, Haml, Sass,
CoffeeScript, etc.), so you can use the template engine of your choice.</p>

<p>To set up <code>Cuba::Render</code>, do:</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s2">"cuba"</span>
<span class="nb">require</span> <span class="s2">"cuba/render"</span>
<span class="nb">require</span> <span class="s2">"erb"</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">plugin</span><span class="p">(</span><span class="no">Cuba</span><span class="o">::</span><span class="no">Render</span><span class="p">)</span>
</pre></div>

<p>This example uses ERB, a template engine that comes with Ruby. If you want to
use another template engine, one <a href="https://github.com/rtomayko/tilt/blob/master/docs/TEMPLATES.md">supported by Tilt</a>, you need to
install the required gem and change the <code>template_engine</code> setting as shown
below.</p>

<div class="highlight highlight-ruby"><pre><span class="no">Cuba</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:render</span><span class="o">][</span><span class="ss">:template_engine</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"haml"</span>
</pre></div>

<p>The plugin provides three helper methods for rendering templates: <code>partial</code>,
<code>view</code> and <code>render</code>.</p>

<div class="highlight highlight-ruby"><pre><span class="no">Cuba</span><span class="o">.</span><span class="n">define</span> <span class="k">do</span>
  <span class="n">on</span> <span class="s2">"about"</span> <span class="k">do</span>
    <span class="c1"># `partial` renders a template called `about.erb` without a layout.</span>
    <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="n">partial</span><span class="p">(</span><span class="s2">"about"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">on</span> <span class="s2">"home"</span> <span class="k">do</span>
    <span class="c1"># Opposed to `partial`, `view` renders the same template</span>
    <span class="c1"># within a layout called `layout.erb`.</span>
    <span class="n">res</span><span class="o">.</span><span class="n">write</span> <span class="n">view</span><span class="p">(</span><span class="s2">"about"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">on</span> <span class="s2">"contact"</span> <span class="k">do</span>
    <span class="c1"># `render` is a shortcut to `res.write view(...)`</span>
    <span class="n">render</span><span class="p">(</span><span class="s2">"contact"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>By default, <code>Cuba::Render</code> assumes that all templates are placed in a folder
named <code>views</code> and that they use the proper extension for the chosen template
engine. Also for the <code>view</code> and <code>render</code> methods, it assumes that the layout
template is called <code>layout</code>.</p>

<p>The defaults can be changed through the <code>Cuba.settings</code> method:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Cuba</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:render</span><span class="o">][</span><span class="ss">:template_engine</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"haml"</span>
<span class="no">Cuba</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:render</span><span class="o">][</span><span class="ss">:views</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"./views/admin/"</span>
<span class="no">Cuba</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:render</span><span class="o">][</span><span class="ss">:layout</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"admin"</span>
</pre></div>

<p>NOTE: Cuba doesn't ship with Tilt. You need to install it (<code>gem install tilt</code>).</p>

<h2>
<a name="plugins" class="anchor" href="#plugins"><span class="octicon octicon-link"></span></a>Plugins</h2>

<p>Cuba provides a way to extend its functionality with plugins.</p>

<h3>
<a name="how-to-create-plugins" class="anchor" href="#how-to-create-plugins"><span class="octicon octicon-link"></span></a>How to create plugins</h3>

<p>Authoring your own plugins is pretty straightforward.</p>

<div class="highlight highlight-ruby"><pre><span class="k">module</span> <span class="nn">MyOwnHelper</span>
  <span class="k">def</span> <span class="nf">markdown</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
    <span class="no">BlueCloth</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">plugin</span> <span class="no">MyOwnHelper</span>
</pre></div>

<p>That's the simplest kind of plugin you'll write. In fact, that's exactly how
the <code>markdown</code> helper is written in <code>Cuba::TextHelpers</code>.</p>

<p>A more complicated plugin can make use of <code>Cuba.settings</code> to provide default
values. In the following example, note that if the module has a <code>setup</code> method, it will
be called as soon as it is included:</p>

<div class="highlight highlight-ruby"><pre><span class="k">module</span> <span class="nn">Render</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">setup</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:template_engine</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"erb"</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">partial</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">locals</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="n">render</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">template</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">settings</span><span class="o">[</span><span class="ss">:template_engine</span><span class="o">]</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">locals</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">plugin</span> <span class="no">Render</span>
</pre></div>

<p>This sample plugin actually resembles how <code>Cuba::Render</code> works.</p>

<p>Finally, if a module called <code>ClassMethods</code> is present, <code>Cuba</code> will be extended
with it.</p>

<div class="highlight highlight-ruby"><pre><span class="k">module</span> <span class="nn">GetSetter</span>
  <span class="k">module</span> <span class="nn">ClassMethods</span>
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
      <span class="n">settings</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
      <span class="n">settings</span><span class="o">[</span><span class="n">key</span><span class="o">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">plugin</span> <span class="no">GetSetter</span>

<span class="no">Cuba</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="ss">:foo</span><span class="p">,</span> <span class="s2">"bar"</span><span class="p">)</span>

<span class="n">assert_equal</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="no">Cuba</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span>
<span class="n">assert_equal</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="no">Cuba</span><span class="o">.</span><span class="n">settings</span><span class="o">[</span><span class="ss">:foo</span><span class="o">]</span>
</pre></div>

<h2>
<a name="contributing" class="anchor" href="#contributing"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>A good first step is to meet us on IRC and discuss ideas. If that's
not possible, you can create an issue explaning the proposed change
and a use case. We pay a lot of attention to use cases, because our
goal is to keep the code base simple. In many cases, the result of
a conversation will be the creation of another tool, instead of the
modification of Cuba itself.</p>

<p>If you want to test Cuba, you may want to use a gemset to isolate
the requirements. We recommend the use of tools like <a href="http://cyx.github.io/dep/">dep</a> and
<a href="http://soveran.github.io/gs/">gs</a>, but you can use similar tools like <a href="https://github.com/tonchis/gst">gst</a> or <a href="https://github.com/educabilia/bs">bs</a>.</p>

<p>The required gems for testing and development are listed in the
<code>.gems</code> file. If you are using <a href="http://cyx.github.io/dep/">dep</a>, you can create a gemset
and run <code>dep install</code>.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/soveran">soveran</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>